"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

exports.__esModule = true;
exports.default = void 0;

var _extends2 = _interopRequireDefault(require("@babel/runtime/helpers/extends"));

var _objectWithoutPropertiesLoose2 = _interopRequireDefault(require("@babel/runtime/helpers/objectWithoutPropertiesLoose"));

var _inheritsLoose2 = _interopRequireDefault(require("@babel/runtime/helpers/inheritsLoose"));

var _apiBzzBase = _interopRequireDefault(require("@erebos/api-bzz-base"));

/* eslint-env browser */
var Bzz =
/*#__PURE__*/
function (_BaseBzz) {
  (0, _inheritsLoose2.default)(Bzz, _BaseBzz);

  function Bzz(config) {
    var _this;

    var url = config.url,
        cfg = (0, _objectWithoutPropertiesLoose2.default)(config, ["url"]);
    _this = _BaseBzz.call(this, (0, _extends2.default)({}, cfg, {
      url: new URL(url).href
    })) || this;
    _this._fetch = window.fetch.bind(window);
    return _this;
  }

  var _proto = Bzz.prototype;

  _proto.uploadDirectory = function uploadDirectory(directory, options) {
    if (options === void 0) {
      options = {};
    }

    var form = new FormData();
    Object.keys(directory).forEach(function (key) {
      form.append(key, new Blob([directory[key].data], {
        type: directory[key].contentType
      }), key);
    });

    if (options.defaultPath != null) {
      var file = directory[options.defaultPath];

      if (file != null) {
        form.append('', new Blob([file.data], {
          type: file.contentType
        }), '');
      }
    }

    return this._upload(form, options);
  };

  return Bzz;
}(_apiBzzBase.default);

exports.default = Bzz;