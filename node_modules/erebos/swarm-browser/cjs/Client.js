"use strict";

var _interopRequireWildcard = require("@babel/runtime/helpers/interopRequireWildcard");

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

exports.__esModule = true;
exports.default = void 0;

var _createClass2 = _interopRequireDefault(require("@babel/runtime/helpers/createClass"));

var _assertThisInitialized2 = _interopRequireDefault(require("@babel/runtime/helpers/assertThisInitialized"));

var _inheritsLoose2 = _interopRequireDefault(require("@babel/runtime/helpers/inheritsLoose"));

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _rpcBrowser = _interopRequireWildcard(require("@mainframe/rpc-browser"));

var _rpcStream = _interopRequireDefault(require("@mainframe/rpc-stream"));

var _apiBzzBrowser = _interopRequireDefault(require("@erebos/api-bzz-browser"));

var _apiPss = _interopRequireDefault(require("@erebos/api-pss"));

var _clientBase = _interopRequireWildcard(require("@erebos/client-base"));

var instantiateAPI = (0, _clientBase.createInstantiateAPI)(_rpcBrowser.default);

var BrowserClient =
/*#__PURE__*/
function (_BaseClient) {
  (0, _inheritsLoose2.default)(BrowserClient, _BaseClient);

  function BrowserClient(config) {
    var _this;

    if (config.rpc == null && config.ws != null) {
      config.rpc = (0, _rpcBrowser.wsRPC)(config.ws);
    }

    _this = _BaseClient.call(this, config) || this;
    (0, _defineProperty2.default)((0, _assertThisInitialized2.default)(_this), "_bzz", void 0);
    (0, _defineProperty2.default)((0, _assertThisInitialized2.default)(_this), "_pss", void 0);

    if (config.bzz != null) {
      if (config.bzz instanceof _apiBzzBrowser.default) {
        _this._bzz = config.bzz;
      } else {
        _this._bzz = new _apiBzzBrowser.default(config.bzz);
      }
    } else if (typeof config.http === 'string') {
      _this._bzz = new _apiBzzBrowser.default({
        url: config.http
      });
    } // $FlowFixMe: instance type


    _this._pss = instantiateAPI(config.pss, _apiPss.default);
    return _this;
  }

  (0, _createClass2.default)(BrowserClient, [{
    key: "bzz",
    get: function get() {
      if (this._bzz == null) {
        throw new Error('Missing Bzz instance or HTTP URL');
      }

      return this._bzz;
    }
  }, {
    key: "pss",
    get: function get() {
      if (this._pss == null) {
        this._pss = new _apiPss.default(this.rpc);
      }

      return this._pss;
    }
  }]);
  return BrowserClient;
}(_clientBase.default);

exports.default = BrowserClient;